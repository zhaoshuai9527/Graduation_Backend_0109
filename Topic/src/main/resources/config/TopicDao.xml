<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.topic.dao.TopicDao">

   <parameterMap id="topic" type="com.topic.entity.Topic"></parameterMap>
   <parameterMap id="selectTopic" type="com.topic.entity.SelectTopic"></parameterMap>

    <select id="getTopicList" resultType="com.topic.entity.Topic">
        select * from tf_f_topic where titleName like  CONCAT(#{query},'%')
    </select>

    <select id="getTopicListByTeacherName" resultType="com.topic.entity.Topic">
        select a.* from tf_f_topic a , tf_f_teacher b where a.teacherNo = b.teachNo and teachName like  CONCAT(#{query},'%') order by count desc
    </select>

    <select id="getTopicListOfAll" resultType="com.topic.entity.Topic">
        select * from tf_f_topic order by count desc
    </select>

    <insert id="publishTopic" >
        insert into tf_f_topic (titleNo,titleName,titleRequire,titleDescribe,teacherNo,admission,limitNum)
        VALUES (#{titleNo}, #{titleName},
                #{titleRequire},#{titleDescribe},
                #{teacherNo},#{admission},#{limitNum})
    </insert>

    <update id="editTopic">
        update tf_f_topic set titleName = #{titleName}, titleRequire = #{titleRequire}, titleDescribe = #{titleDescribe},
                              teacherNo = #{teacherNo}, limitNum = #{limitNum}
        where titleNo = #{titleNo} and admission = #{admission}
    </update>

    <delete id="deleteTopic">
        delete  from tf_f_topic where titleNo = #{titleNo}
    </delete>


    <select id="qryTeacherNameByTeacherNo" resultType="java.lang.String">
        select teachName from tf_f_teacher where teachNo = #{teachNo}
    </select>


    <select id="qryIfSelectedTopic" resultType="java.lang.Integer">
        select count(*) from tf_f_selectTopic where stuNo = #{stuNo} and titleNo = #{titleNo}
    </select>
    <select id="qryIfSelectedTopicMax" resultType="java.lang.Integer">
        select count(*) from tf_f_selectTopic where stuNo = #{stuNo}
    </select>

    <insert id="selectTopic" parameterMap="selectTopic">
        insert into tf_f_selectTopic (titleNo,titleName,teachNo,teachName,stuNo,stuName,selectTime)
        VALUES (#{titleNo}, #{titleName},
                #{teacherNo},#{teacherName},
                #{stuNo},#{stuName},
                #{selectTime}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    )
    </insert>

    <update id="updateTopicCount">
        update tf_f_topic set count = #{count} where titleNo = #{titleNo}
    </update>


</mapper>